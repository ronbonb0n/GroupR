# About:

This is the game development project repository for the game **Fer≈∑nier** made by students of *MSc Computer Games, Queen Mary University of London.*

# Installation:

1. [Install Unity version 2022.1.19f1](https://unity3d.com/get-unity/download/archive)

2. Install WebGL support.

3. Add project to the Unity Hub with the correct Unity version.

## Additional Links for Development Process:

-   [Design and Development Board](https://app.milanote.com/1OICvn1gp26tem?p=QvLbpGpKO8B)

## References:

-   [Reference for AI mapping technique](https://www.youtube.com/watch?v=iY1jnFvHgbE&t=513s)
-   [State Machine](https://www.youtube.com/watch?v=nnrOhb5UdRc)
-   [AI Sight](https://www.youtube.com/watch?v=j1-OyLo77ss)
-   [Field of View Effect](https://www.youtube.com/watch?v=CSeUMTaNFYk)
-   [Chase](https://www.youtube.com/watch?v=wp8m6xyIPtE)
-   [Player Movement](https://www.youtube.com/watch?v=HmXU4dZbaMw)
-   [Cloak Ability](https://www.youtube.com/watch?v=u8gssV_Ec-Y)
-   [EMP & Decoy](https://www.youtube.com/watch?v=BYL6JtUdEY0)

_\* Currently the project is being developed for prototyping_

# Notes

## World map design proceduralism

**_Note_: World map isn't procedurally generated within game, instead this proceduralism is an experimentation with tools that can speed up level development.**<br/>
The tiles that make up the map are generated by and image - each pixel represents the tile.<br/>

Currently the generator can support up to 10 different tile types and changes to the code base can be implemented to expand this.<br/>

Tile rotation is not yet implemented - can be done if RGB values are used, instead of just luminosity.<br/>

The generator image is found in the root/Assets/ directory.<br/>

For some reason only jpeg seemed to work. This might be due to encoding methods JPEG encodes per pixel,
whilst PNG encodes for each scan-line of pixel.<br/>

The generator script runs within the engine editor for ease of use.<br/>

The generator will build the navmesh required for the topdown nav for you but this can be overwritten manually via Unity's Navigation tab.<br/>

**The pixel values currently used are tabulated below**

|   Tile Type   | Hex Code(#) | Decimal |
| :-----------: | :---------: | :-----: |
|     Grass     |   FFFFFF    |   1.0   |
|  Deep Grass   |   E6E6E6    |   0.9   |
|  Dying Grass  |   CCCCCC    |   0.8   |
|  Dead Space   |   B2B2B2    |   0.7   |
|    Bridge     |   999999    |   0.6   |
|  Tower/Level  |   808080    |   0.5   |
|     Water     |   000000    |   0.0   |
| Sci-Fi Bridge |   666666    |   0.4   |

**_Note_:Currently the Coast block is not being used and may be dropped**<br/>
**_Note_:Water block technically represents a lack of a block for render efficiency as we can represent the water with just a single plain**<br/>

**Updates to the generator will be placed in the table when neccassary**<br/>

To use the tool:<br/>

1. Open the image in any image editing software - Krita is recommended because it is cost-free and reasonably capable.
2. Adjust image with a solid square brush - Krita has a pixel art brush which is ideal
   - Use colours tabulated above to correspond with desired tiles
3. Export the output overwriting past image - or export new output but make sure to encode it properly with JPEG max quality
   - If you export a new image when in Unity:
     - Enable read/write in image properties
     - Set format to RGBA32
     - Set non power of 2 to None
4. Within the world map scene there is already an object called world builder that contains the builder script
   - Make sure the correct prefabs are assigned
   - Make sure the correct world generator texture is assigned
5. It is recommenended that you delete the game object called **Parent** that holds all of the tiles within it's heirarchy
6. Go back to your world builder GameObject and click the execute boolean button - Your updated world will be built<br/>

## Dungeon generator tool

This tool functions very similarly to the above tool - but instead of single channel luminosity values, the tool utilises RGB values.<br/>

The generator currently supports 20 different tile types and this is expandable - however colour coding will quickly become ungainly beyond this.<br/>

The generator images is found in the root/Assets/ directory - one image per dungeon (there are currently two built dungeons within the prototype).<br/>

Again the tool requires JPEG images.<br/>

Currently the tool doesn't build the navmesh automonously - for now simply select the parent, designate it as static navigation and bake manually. This requires minimal effort, but I will look into this after the prototype as a future improvement.<br/>

Use the tool in the same way as the world map builder - but instead use the RGB values tabulated below.<br/>

**The pixel values currently used are tabulated below**<br/>

| Tile Type                 | Hex Code(#) | R    | G    | B    |
| ------------------------- | ----------- | ---- | ---- | ---- |
| Open Area                 | FFFFFF      | 1.0  | 1.0  | 1.0  |
| Empty Space               | 000000      | 0.0  | 0.0  | 0.0  |
| Outer Top Right Corner    | 33664D      | 0.2  | 0.4  | 0.3  |
| Outer Top Left Corner     | 01FFFF      | 0.0  | 1.0  | 1.0  |
| Outer Bottom Right Corner | 4DFF66      | 0.3  | 1.0  | 0.4  |
| Outer Bottom Left Corner  | FFFF00      | 1.0  | 1.0  | 0.0  |
| Inner Top Right Corner    | FFBFFF      | 1.0  | 0.7  | 1.0  |
| Inner Top Left Corner     | CCFF80      | 0.8  | 1.0  | 0.5  |
| Inner Bottom Right Corner | FF7F86      | 1.0  | 0.5  | 0.6  |
| Inner Bottom Left Corner  | FFB200      | 1.0  | 0.7  | 0.0  |
| Left Wall                 | 0000FF      | 0.0  | 0.0  | 1.0  |
| Right Wall                | 01FF00      | 0.0  | 1.0  | 0.0  |
| Top Wall                  | 8099FF      | 0.5  | 0.6  | 1.0  |
| Bottom Wall               | 338033      | 0.2  | 0.5  | 0.2  |
| Up Down Corridor          | 334D7F      | 0.2  | 0.3  | 0.5  |
| Across Corridor           | FF994D      | 1.0  | 0.6  | 0.3  |
| Left Doorway              | 404040      | 0.3  | 0.3  | 0.3  |
| Right Doorway             | BFBFBF      | 0.7  | 0.7  | 0.7  |
| Top Doorway               | FF0059      | 1.0  | 0.0  | 0.3  |
| Bottom Doorway            | FF4D00      | 1.0  | 0.3  | 0.0  |

**_Note_: When something is designated as (for example) "left" this designates the position of the feature on the tile, as such a left doorway is a tile with a doorway on the left handside**<br/>
**_Note_: A swatch with all of the above colours is included as a JPEG**<br/>
**_Note_: The greens used for bottom right corner and left wall are very similar and tend to blend- this will be changed in the next update**<br/>
**_Note_: There are some misaligning pillars - this is an issue with my meshes not the tool. The meshes were made quick and roughly to not waste time on making something look pretty, when it would be changed and upgraded later on anyway**<br/>
**_Limitations_: Once you start to recognise the colours this is an easy tool to use, but to someone who has never used it before the bitmaps that drive the tool might be confusing. Consideration into this will be taken, at the very least templates can be built from snippets of the bitmaps to create entire rooms or sections by just copying and pasting pixels - but this might lead to level repetiton. The tool would ideally paired with the WFC algorithm depending on time. With this being said though, with it I can build a level in under 10 minutes. This tool and mindset was inspired by my experience using houdini following work by the likes of Simon Verstraete, see here: https://www.sidefx.com/tutorials/wfc-dungeon-generator/**<br/>
<br/>
**_Post Prototype_: Implemented the tile variant Wave Function Collapse Algorithm - This removes the above limitation as all confusion around working with the bitmaps is nullified. The environment artist merely has to run a script and the bitmaps are generated. Furthermore the algorithm is run on coded tile relationships - so no template image is required**<br/>

## Player controls in world map

The NavMesh system from Unity, powers the player controls in the world map.<br/>

Click on a tile with the left mouse button and go.<br/>

The original idea was to create a custom A* pathfinder, but given Unity's NavMesh system's functionality and performance, it was deemed there wasn't much purpose in doing so.<br/>

**Plans to implement a tile highlighting system for improved accessibility**<br/>

## Player controls in level

Player is controlled via a combination of mouse and keyboard inputs.<br/>

Consideration has been taken to allow a user to control the player with either a laptop touchpad or mouse to improve accessibilty.<br/>

Controls have been updated with Unity's new input system to allow for easier remapping <br/>

**Controls tabulated below**

|    Output    |           Keyboard           |    Mouse    |             Gesture              |
| :----------: | :--------------------------: | :---------: | :------------------------------: |
| Strafe-Left  |              A               |     N/A     |               N/A                |
| Strafe-Right |              D               |     N/A     |               N/A                |
| Move-Forward |              W               |     N/A     |               N/A                |
|  Move-Back   |              S               |     N/A     |               N/A                |
|   Crouch     |           L-CTRL/C           |     N/A     |               N/A                |
|     Run      |           L-SHIFT            |     N/A     |               N/A                |
|    Cloak     |              E               |     N/A     |               N/A                |
|     EMP      |             N/A              |     LMB     |               N/A                |
|    Decoy     |             N/A              |     RMB     |               N/A                |
|   Zoom In    |              R               |  Scroll Up  |  MousePad - Two finger swipe up  |
|   Zoom Out   |              F               | Scroll Down | MousePad - Two finger swipe down |
 <!--Rotate  | Q or E (Direction dependent) |     N/A     |              N/A-->              

**Remapping yet to be implemented**

## Level transitioning

Level transitioning is driven by a simple trigger overlap with the player character.<br/>

Once the player overlaps the trigger - if within one tile of the level trigger, they can click on the map object which will call the level transition.<br/>

**Some kind of element will be rendered to highlight that the player can call the transition to act as positive feedback for improved accessibility**<br/>

## Frame Rate Cap

Simple script to cap the number of frames - cap is public.<br/>

**Cap will be adjustable to allow for higher and lower end machines**<br/>

## AI Drones

### Sight

Drone sight has a radius and angle, implemented by ray cast.

### States

Using a state machine to switch between behaviors of AI drones:

![Stealth AI - State Machine](https://user-images.githubusercontent.com/45759373/203607165-a875609b-d47d-4df7-af23-b12344cdaa7c.png)

1. *Idle* (initial state)
2. *Patrol* - Pick a random patrol location and auto-path to it
3. *Look Around* - Stay put and look around
4. *Alert* - Transition state from *Look Around* to *Chase*
5. *Investigate* - Go to where the player is last seen at
6. *Chase* - Chase the player
7. *Deactivated* - Shut down & Fall to the ground

### Map Set Up

- Player
  - Tag - Player
- Map plane
  - Navigation Static
- Walls
  - Navigation Static
- Drone
  - Tag - Drone

**And, bake the Nav Mesh*.

## Wave Function Collapse:

The wave function collapse algorithm, as well as the secondary clustering and clearning algorithm was implemented within Python to be used as an external tool to procedurally develop level plans that are represented as bitmaps and implemented with an in-engine script, developed during the prototyping phase. This tool was not developed to be a perfectly efficient reproduction of the WFC, but instead as a personal learning experiment to better understand and learn about the algorithms.

#### If you wish to test and experiment with the tool please adhere to the following instructions:

##### It is highly recommended that you create a fresh python virtual environment
###### Unix/MacOS
`python3 -m pip install --user virtualenv`<br />
`python3 -m venv env`
###### Windows
`py -m pip install --user virtualenv`<br />
`py -m venv env`
##### Activate venv and upon activation install python dependencies with the requirements file
###### Unix/MacOS
`python3 -m pip install [options] -r <requirements file>`
###### Windows
`py -m pip install [options] -r <requirements file>`

Execute ```main.py``` within the venv. The tool is CLI based and will request the dimensions as a single integer, for example a user input of 5 will result in an output of 5 x 5 pixels and therefore a maximum tile count of 25, where each pixel represents a tile. Please execute the file within the same directory where the program and Dungeon-Map-Generator-Swatch.jpg is saved.

**NOTE: It is recommended that a minimum dimension is no less than 4**

The second input that is required is the export directory string that contains both the file destination and the name of the file as a png. For example: `./example/dir/test.png`

For the purpose of level development the bitmaps were exported into Unity's assets directory where their compression was set to none and run through the DungeonBuilder.cs script to generate the games levels.

#### For referencing purposes the external packages that the tool directly calls upon are as follows:<br/>
**NOTE: All of these packages will be installed via the requirements.txt install file via pip and PyPi**<br/>
-   [NumPy](https://numpy.org/) Vectorisation of data and a requirement for Pillow
-   [Pillow](https://pillow.readthedocs.io/en/stable/) For Encoding the final output to PNG and process the RGB values from the swatch
-   [TQDM](https://github.com/tqdm/tqdm) For the simple loading bar
-   [SciPy](https://scipy.org/) Extremely useful set of functions that aided with the clustering algorithm after the WFC had terminated to make sure there are no inaccessible locations within the map
-   [Colorama](https://pypi.org/project/colorama/) To colour the verbose output

## 3D Art Assets:

A simple directory containing our blender files with the colour swatch required by the static meshes and drones and the texture map required by our character. If you wish to look through the blender file - make sure to download these bitmaps as well and keep them in the same directory as the downloaded blender file, otherwise you shall just get a purple hue when looking at the material renderings due to missing assets.<br/>

The concept for the level buildings seen within the orthographic world map was inspired by some of the products produced by [MeshTint](https://www.meshtint.com/). All 3D assets are of our own design and artistic creation, I simply used the images from their products as conceptual inspiration.

# GUI heads up display files:
Five simple png bitmaps for our in game GUI, produced to provide a sci-fi feel and provide just an aesthetic function

## Sounds:

Almost all of the sounds that have been used in the game were created specifically for it, either using an online tool [jsfxr](https://sfxr.me/) or by recording them with a microphone and editing them afterward. Huge efforts were made to produce each and every sound for the game; however, due to a lack of resources, expertise, and equipment to create original audio files, some couldn't be produced from scratch.

Using an open-source website, [Freesound](https://freesound.org/), that offers sounds that can be used in projects, some sounds were used to get inspiration. Based on those sounds, new audio files were produced, edited, and passed through pitch and amplitude shifters, de-noisers, exponential fades, and other filters to make them suitable for the game:

- Drones' rotors: Eelke's sound was modified (available at https://freesound.org/people/Eelke/sounds/198235/) and used it in the game.
- Background ambience of a level: Edited the sound provided by Flamiffer (available at https://freesound.org/people/Flamiffer/sounds/530161) and used it in the game.
- The sound of the Decoy: Tweaked Breviceps' sound (available at https://freesound.org/people/Breviceps/sounds/493162) and used it in the game. 
